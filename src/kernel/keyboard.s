.CODE32

.GLOBL KBD
.EXTERN CURSOR_POSITION
.EXTERN IRQ_DONE
.EXTERN CURSOR_MOVE

KBD:
	XOR %EAX, %EAX
	IN $0x60, %AL
	CMP $0x80, %EAX
	JGE .SKIP
	CMP $0x1C, %EAX
	JNE .SHOW
	MOV CURSOR_POSITION, %EDI
	CALL NL
	JMP .MOVE
	.SHOW:
	LEA KBMAP, %EBX
	ADD %EAX, %EBX
	MOV (%EBX), %AL
	OR %AL, %AL
	JZ .SKIP
	MOV $0x0F, %AH
	MOV CURSOR_POSITION, %EDI

	STOSW
	.MOVE:
	CALL CURSOR_MOVE

	MOV %EDI, CURSOR_POSITION
	.SKIP:
	JMP IRQ_DONE

.SECTION .rodata
KBMAP:
	.BYTE 0x00
	.BYTE 0x1b
	.ASCIZ "1234567890-=\b\tqwertyuiop[]\n"
	.ASCIZ "asdfghjkl;'`"
	.ASCIZ "\\zxcvbnm,./"
	.BYTE 0x2a
	.BYTE 0x00
	.BYTE 0x20

