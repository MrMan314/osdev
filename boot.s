.CODE16

.GLOBAL _start

_start:
	CLI
	MOVW $0x9000, %SP
	MOVW %BP, %SP
	MOV %DL, BD
	LJMP $0x0, $MAIN

MAIN:
	XOR %AX, %AX
	MOV %AX, %DS
	MOV %AX, %ES
	MOV %AX, %FS
	MOV %AX, %GS
	MOV %AX, %SS
	MOVW $0x7C00, %SP

	MOVW $0x0013, %AX
	INT $0x10

	MOV $HELLO, %SI
	CALL PRINT

	XOR %AX, %AX
	MOV %AX, %DS
	CLD

	MOV $0x0240, %AX
	MOV $0x0002, %CX
	XOR %DH, %DH
	XOR %BX, %BX
	MOV %BX, %ES
	MOV $0x7E00, %BX
	INT $0x13
	JC .ERR

	MOV $0x7E00, %SI
	CALL DISP

	XOR %AX, %AX
	MOV %AX, %DS
	CLD

	CMP $0x80, BD
	JL .FDREAD
	MOV $0x0002, %CX
	JMP .READ
.FDREAD:
	MOV $0x010B, %CX
.READ:
	MOV $0x0240, %AX
	XOR %BX, %BX
	MOV %BX, %ES
	INC %DH
	MOV $0x7E00, %BX
	INT $0x13
	JC .ERR2

	MOV $0x7FFF, %SI
	CALL DISP2

	JMP .LOOP	

DISP:
	PUSHA
	XOR %CX, %CX
	XOR %DX, %DX
	JMP DISPSTART
DISP2:
	PUSHA
	MOV $102, %DX
	MOV $127, %CX
DISPSTART:
	XORB %BH, %BH
	MOVB $0x0C, %AH
	LODSB
	CMP $0x7FFF, %CX
	JGE DISPDONE
	INT $0x10
	INC %CX
	JMP DISPSTART
DISPDONE:
	POPA
	RET

PRINT:
	PUSHA
PRINTSTART:
	XORB %BH, %BH
	MOVB $0x0F, %BL
	MOVB $0x0E, %AH
	LODSB
	OR %AL, %AL
	JZ PRINTDONE
	INT $0x10
	JMP PRINTSTART
PRINTDONE:
	POPA
	RET

.ERR2:
	MOV $ERR2, %SI
	CALL PRINT
	JMP .LOOP
.ERR:
	MOV $ERR, %SI
	CALL PRINT
.LOOP:
	JMP .LOOP


BD: .WORD 0x0000
HELLO: .ASCIZ "hello vro\r\n"
ERR: .ASCIZ "help vro\r\n"
ERR2: .ASCIZ "VRO HELP ME\r\n"
.FILL 0x1EB-(.-_start), 0x01, 0x00
.ASCIZ "im gonna touch you"
.WORD 0xAA55
